{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "3d26b496-33a3-49f3-a1e9-eb6611686ac2",
            "version": "KqlParameterItem/1.0",
            "name": "GroupName",
            "type": 1,
            "isRequired": true,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "operator": "Default",
                  "resultValType": "static",
                  "resultVal": "| extend Group = case(ActivityDisplayName in (\"Add member to group\",\"Add owner to group\"), tostring(parse_json(tostring(parse_json(tostring(TargetResources[0].modifiedProperties))[1].newValue))), ActivityDisplayName in (\"Remove member from group\",\"Remove owner from group\"), tostring(parse_json(tostring(parse_json(tostring(TargetResources[0].modifiedProperties))[1].oldValue))), ActivityDisplayName in (\"Add group\",\"Delete group\",\"Update group\",\"Set group license\",\"Start applying group based license to users\",\"Finish applying group based license to users\"), tostring(TargetResources[0].displayName), ActivityDisplayName == \"Add app role assignment to group\", tostring(parse_json(tostring(parse_json(tostring(TargetResources[0].modifiedProperties))[4].newValue))), ActivityDisplayName in (\"Remove app role assignment from group\", \"Add a deletion-marked app role assignment grant to group as part of link removal\") , tostring(parse_json(tostring(parse_json(tostring(TargetResources[0].modifiedProperties))[4].oldValue))),   \"UnknownActivityType\")"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "37fbdb37-1217-47f5-885e-8645a804188f",
            "version": "KqlParameterItem/1.0",
            "name": "GroupId",
            "type": 1,
            "isRequired": true,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "operator": "Default",
                  "resultValType": "static",
                  "resultVal": "| extend GroupId = case(ActivityDisplayName in (\"Add member to group\",\"Add owner to group\"), tostring(parse_json(tostring(parse_json(tostring(TargetResources[0].modifiedProperties))[0].newValue))), ActivityDisplayName in (\"Remove member from group\",\"Remove owner from group\"), tostring(parse_json(tostring(parse_json(tostring(TargetResources[0].modifiedProperties))[0].oldValue))), ActivityDisplayName in (\"Add group\",\"Delete group\",\"Update group\",\"Set group license\",\"Start applying group based license to users\",\"Finish applying group based license to users\"), tostring(TargetResources[0].id), ActivityDisplayName == \"Add app role assignment to group\", tostring(parse_json(tostring(parse_json(tostring(TargetResources[0].modifiedProperties))[3].newValue))), ActivityDisplayName in (\"Remove app role assignment from group\",\"Add a deletion-marked app role assignment grant to group as part of link removal\"), tostring(parse_json(tostring(parse_json(tostring(TargetResources[0].modifiedProperties))[3].oldValue))), \"UnknownActivityType\")"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "d9d4b32e-740e-41aa-85a0-6a84bfde4b79",
            "version": "KqlParameterItem/1.0",
            "name": "UserDetails",
            "type": 1,
            "isRequired": true,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "operator": "Default",
                  "resultValType": "static",
                  "resultVal": "| extend Object = case(ActivityDisplayName in (\"Add member to group\",\"Remove member from group\", \"Add owner to group\"), tostring(TargetResources[0].userPrincipalName), \"\") | extend ObjectId = case(ActivityDisplayName in (\"Add member to group\",\"Remove member from group\", \"Add owner to group\"), tostring(TargetResources[0].id), \"\") | extend ObjectType = case(ActivityDisplayName in (\"Add member to group\",\"Remove member from group\", \"Add owner to group\"), tostring(TargetResources[0].type), \"\")"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "78f465e5-83be-4e16-868b-1cc045d51e1b",
            "version": "KqlParameterItem/1.0",
            "name": "InitiatedBy",
            "type": 1,
            "isRequired": true,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "operator": "Default",
                  "resultValType": "static",
                  "resultVal": "| extend InitiatedByType = case(isnotempty(InitiatedBy.app), \"app\", \"user\") | extend InitiatedByName = case(      InitiatedByType == \"app\", InitiatedBy.app.displayName,     InitiatedByType == \"user\", InitiatedBy.user.userPrincipalName,     \"Error - Unknown\"     ) | extend InitiatedById = case(      InitiatedByType == \"app\", InitiatedBy.app.servicePrincipalId,     InitiatedByType == \"user\", InitiatedBy.user.id,     \"Error - Unknown\"     )"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            }
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters - workbook functions"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "parameters": [
          {
            "id": "c0e1db28-a9e3-4f0d-b94d-a138d42b1cde",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "type": 4,
            "isGlobal": true,
            "value": {
              "durationMs": 2592000000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 300000
                },
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                }
              ],
              "allowCustom": true
            }
          },
          {
            "id": "1f74ed9a-e3ed-498d-bd5b-f68f3836a117",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "label": "Subscriptions",
            "type": 6,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "Resources\r\n| where type =~ \"microsoft.operationalinsights/workspaces\"\r\n| summarize Count = count() by subscriptionId\r\n| order by Count desc\r\n| extend Rank = row_number()\r\n| project value = subscriptionId, label = subscriptionId, selected = Rank == 1",
            "crossComponentResources": [
              "value::selected"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": [
              "/subscriptions/d1d8779d-38d7-4f06-91db-9cbc8de0176f"
            ]
          },
          {
            "id": "173f251f-558e-415f-b5ca-f25cfa01f6ee",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "type": 5,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "where type =~ \"microsoft.operationalinsights/workspaces\"\r\n| project id",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "value": [
              "/subscriptions/d1d8779d-38d7-4f06-91db-9cbc8de0176f/resourceGroups/SOC/providers/Microsoft.OperationalInsights/workspaces/CyberSecuritySOC",
              "/subscriptions/d1d8779d-38d7-4f06-91db-9cbc8de0176f/resourceGroups/soc/providers/microsoft.operationalinsights/workspaces/cybersecuritysoc"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "c3acef71-4299-4ae7-a53c-f361c8327757",
            "version": "KqlParameterItem/1.0",
            "name": "SelectedAADTenantId",
            "label": "AAD Tenant",
            "type": 2,
            "description": "This is the AAD Tenant which the logs originated from",
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "AuditLogs\r\n| where Category == \"GroupManagement\"\r\n| distinct AADTenantId",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "selectAllValue": "*",
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 172800000
            },
            "timeContextFromParameter": "TimeRange",
            "defaultValue": "value::all",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "662c4900-ffcf-4bc3-903d-472a1cc6e9e9",
            "version": "KqlParameterItem/1.0",
            "name": "Help",
            "label": "Show Help",
            "type": 10,
            "description": "This will show some help information, in order to better use this workbook",
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[{ \"value\": \"true\", \"label\": \"Yes\"},\r\n {\"value\": \"false\", \"label\": \"No\", \"selected\":true },\r\n {\"value\": \"Change Log\", \"label\": \"Change Log\"}]"
          },
          {
            "id": "0956cf95-47f8-42d4-81c8-2acedcc7dae9",
            "version": "KqlParameterItem/1.0",
            "name": "LimitGridRowsTo",
            "label": "Limit Grid Rows To",
            "type": 1,
            "description": "This is used inside Log Analytics queries that return a high number of results and allow for \"pages\" of data to be displayed. You must change the \"Limit Grid Rows To\" parameter in the various query objects seperately.",
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "operator": "Default",
                  "resultValType": "static",
                  "resultVal": "250"
                }
              }
            ]
          }
        ],
        "style": "above",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters - 0"
    },
    {
      "type": 1,
      "content": {
        "json": "## Azure Active Directory Group Management Workbook\r\n\r\nThis Workbook has been designed to help admins analyse actions performed against Azure AD Groups. This has been built based on the below activites, however this is not a complete list and some activites may still render as UnknownActivityType as the Workbook is improved.\r\n\r\n|Activities List|\r\n|---|\r\n|Add member to group|\r\n|Remove member from group|\r\n|Add owner to group|\r\n|Remove owner from group|\r\n|Add group|\r\n|Delete group|\r\n|Update group|\r\n|Set group license|\r\n|Start applying group based license to users|\r\n|Finish applying group based license to users|\r\n|Add app role assignment to group|\r\n|Remove app role assignment from group|\r\n|Add a deletion-marked app role assignment grant to group as part of link removal|\r\n\r\n",
        "style": "info"
      },
      "conditionalVisibility": {
        "parameterName": "Help",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Help 1"
    },
    {
      "type": 1,
      "content": {
        "json": "## Azure Active Directory Group Tracking\r\n### Change Log\r\n\r\n|Version|Description|Date|Editor|\r\n|---|---|---|---|\r\n|v1.0.0| Initial Release |October 2021| Alistair Ross\r\n|v1.1.0| Expanded to included more Activities |November 2021| Alistair Ross\r\n\r\n|List of all Known Activities|Added|\r\n|---|---|\r\n|Add a deletion-marked app role assignment grant to group as part of link removal|TRUE|\r\n|Add app role assignment to group|TRUE|\r\n|Add contact|FALSE|\r\n|Add eligible member to role in PIM completed (permanent)|FALSE|\r\n|Add eligible member to role in PIM completed (timebound)|FALSE|\r\n|Add eligible member to role in PIM requested (permanent)|FALSE|\r\n|Add eligible member to role in PIM requested (renew)|FALSE|\r\n|Add eligible member to role in PIM requested (timebound)|FALSE|\r\n|Add group|TRUE|\r\n|Add Member|FALSE|\r\n|Add member to group|TRUE|\r\n|Add member to role approval requested (PIM activation)|FALSE|\r\n|Add member to role canceled (PIM activation)|FALSE|\r\n|Add member to role completed (PIM activation)|FALSE|\r\n|Add member to role in PIM completed (permanent)|FALSE|\r\n|Add member to role in PIM completed (timebound)|FALSE|\r\n|Add member to role in PIM requested (permanent)|FALSE|\r\n|Add member to role in PIM requested (renew)|FALSE|\r\n|Add member to role in PIM requested (timebound)|FALSE|\r\n|Add member to role request approved (PIM activation)|FALSE|\r\n|Add member to role request denied (PIM activation)|FALSE|\r\n|Add member to role requested (PIM activation)|FALSE|\r\n|Add owner to group|TRUE|\r\n|Add registered owner to device|FALSE|\r\n|Add registered users to device|FALSE|\r\n|Add service principal credentials|FALSE|\r\n|Add user|FALSE|\r\n|Approve a pending request to join a group|FALSE|\r\n|Assign label to group|FALSE|\r\n|Autorenew group|FALSE|\r\n|Bulk import group members - finished (bulk)|FALSE|\r\n|Bulk import group members - started (bulk)|FALSE|\r\n|Bulk remove group members - finished (bulk)|FALSE|\r\n|Bulk remove group members - started (bulk)|FALSE|\r\n|Cancel a pending request to join a group|FALSE|\r\n|Change user license|FALSE|\r\n|Change user password|FALSE|\r\n|Create application password for user|FALSE|\r\n|Create group settings|FALSE|\r\n|Create Group|FALSE|\r\n|Create lifecycle management policy|FALSE|\r\n|Delete a pending request to join a group|FALSE|\r\n|Delete group settings|FALSE|\r\n|Delete group|TRUE|\r\n|Download group members - finished (bulk)|FALSE|\r\n|Download group members - started (bulk)|FALSE|\r\n|Download groups - finished (bulk)|FALSE|\r\n|Download groups - started (bulk)|FALSE|\r\n|Enable Strong Authentication|FALSE|\r\n|Export|FALSE|\r\n|Finish applying group based license to users|TRUE|\r\n|Grant contextual consent to application|FALSE|\r\n|Hard Delete group|FALSE|\r\n|Import|FALSE|\r\n|Offboarded resource from PIM|FALSE|\r\n|Onboarded resource to PIM|FALSE|\r\n|Other|FALSE|\r\n|PIM activation request expired|FALSE|\r\n|Process role removal request|FALSE|\r\n|Process role update request|FALSE|\r\n|Register device|FALSE|\r\n|Reject a pending request to join a group|FALSE|\r\n|Remove app role assignment from group|TRUE|\r\n|Remove eligible member from role in PIM completed (permanent)|FALSE|\r\n|Remove eligible member from role in PIM completed (timebound)|FALSE|\r\n|Remove eligible member from role in PIM requested (permanent)|FALSE|\r\n|Remove eligible member from role in PIM requested (timebound)|FALSE|\r\n|Remove label from group|FALSE|\r\n|Remove member from group|TRUE|\r\n|Remove member from role (PIM activation expired)|FALSE|\r\n|Remove member from role completed (PIM deactivate)|FALSE|\r\n|Remove member from role in PIM completed (permanent)|FALSE|\r\n|Remove member from role in PIM completed (timebound)|FALSE|\r\n|Remove member from role in PIM requested (permanent)|FALSE|\r\n|Remove member from role in PIM requested (timebound)|FALSE|\r\n|Remove member from role requested (PIM deactivate)|FALSE|\r\n|Remove Member|FALSE|\r\n|Remove owner from group|FALSE|\r\n|Remove permanent eligible role assignment|FALSE|\r\n|Remove service principal credentials|FALSE|\r\n|Renew group|FALSE|\r\n|Request to join a group|FALSE|\r\n|Reset password (self-service)|FALSE|\r\n|Reset user password|FALSE|\r\n|Restore Group|FALSE|\r\n|Security info saved for self-service password reset|FALSE|\r\n|Self-service password reset flow activity progress|FALSE|\r\n|Set dynamic group properties|FALSE|\r\n|Set group license|TRUE|\r\n|Start applying group based license to users|TRUE|\r\n|Synchronization rule action|FALSE|\r\n|Trigger group license recalculation|FALSE|\r\n|Unlock user account (self-service)|FALSE|\r\n|Update contact|FALSE|\r\n|Update eligible member in PIM canceled (extend)|FALSE|\r\n|Update eligible member in PIM requested (extend)|FALSE|\r\n|Update group settings|FALSE|\r\n|Update group|TRUE|\r\n|Update lifecycle management policy|FALSE|\r\n|Update member in PIM approved by admin (extend/renew)|FALSE|\r\n|Update member in PIM denied by admin (extend/renew)|FALSE|\r\n|Update member in PIM requested (extend)|FALSE|\r\n|Update role setting in PIM|FALSE|\r\n|Update service principal|FALSE|\r\n|Update StsRefreshTokenValidFrom Timestamp|FALSE|\r\n|Update user|FALSE|\r\n|User started security info registration for self-service password reset|FALSE|\r\n|Validate local account credentials|FALSE|\r\n\r\n\r\n\r\n\r\n\r\n \r\n\r\n\r\n\r\n"
      },
      "conditionalVisibility": {
        "parameterName": "Help",
        "comparison": "isEqualTo",
        "value": "Change Log"
      },
      "name": "text - Change Log"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "parameters": [
          {
            "id": "44ea1499-2049-44fa-b038-982ac3458e05",
            "version": "KqlParameterItem/1.0",
            "name": "GroupStartsWith",
            "label": "Group Starts With",
            "type": 1,
            "description": "Case Insensitive string which the group name begins with",
            "timeContext": {
              "durationMs": 2592000000
            },
            "timeContextFromParameter": "TimeRange"
          },
          {
            "id": "854d1cb5-76f0-4475-b959-0d4a5723426a",
            "version": "KqlParameterItem/1.0",
            "name": "SelectedGroup",
            "label": "AAD Group",
            "type": 2,
            "description": "Name of the AAD Groups. Number represents the number of changes within the time period to the group",
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "AuditLogs\r\n| where Category == \"GroupManagement\"\r\n// extract the Group displayName first for filtering\r\n| where \"{SelectedAADTenantId}\" == \"'*'\" or AADTenantId in ({SelectedAADTenantId})\r\n| extend Group = case(\r\n    ActivityDisplayName in (\"Add member to group\",\"Add owner to group\"), tostring(parse_json(tostring(parse_json(tostring(TargetResources[0].modifiedProperties))[1].newValue))), \r\n    ActivityDisplayName == \"Remove member from group\", tostring(parse_json(tostring(parse_json(tostring(TargetResources[0].modifiedProperties))[1].oldValue))), \r\n    ActivityDisplayName in (\"Add group\",\"Delete group\",\"Update group\",\"Set group license\",\"Start applying group based license to users\",\"Finish applying group based license to users\"), tostring(TargetResources[0].displayName), \r\n    ActivityDisplayName == \"Add app role assignment to group\", tostring(parse_json(tostring(parse_json(tostring(TargetResources[0].modifiedProperties))[4].newValue))), \r\n    ActivityDisplayName == \"Remove app role assignment to group\", tostring(parse_json(tostring(parse_json(tostring(TargetResources[0].modifiedProperties))[4].oldValue))), \r\n    \"UnknownActivityType\"\r\n    )\r\n| where  Group startswith \"{GroupStartsWith}\"\r\n| summarize ActivityCount = count() by Group\r\n| project value = Group, label = strcat(Group,\" (\",ActivityCount,\")\")\r\n| order by value asc",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "value": [
              "All Users",
              "ContosoVendorAccess",
              "IoTEngineering"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "081d3340-7c85-427a-9a55-f65778d21a5a",
            "version": "KqlParameterItem/1.0",
            "name": "SelectedActivity",
            "type": 2,
            "description": "Name of the AAD Groups. Number represents the number of changes within the time period for that activity type for all selected groups",
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "AuditLogs\r\n| where Category == \"GroupManagement\"\r\n// extract the Group displayName first for filtering\r\n| where \"{SelectedAADTenantId}\" == \"'*'\" or AADTenantId in ({SelectedAADTenantId})\r\n{GroupName}\r\n| where \"{SelectedGroup}\" == \"'*'\" or Group in ({SelectedGroup})\r\n| summarize count() by ActivityDisplayName\r\n| extend label = strcat(ActivityDisplayName,\" (\",count_,\")\")\r\n| project value = ActivityDisplayName, label\r\n| order by label asc\r\n ",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "selectAllValue": "*",
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 2592000000
            },
            "timeContextFromParameter": "TimeRange",
            "defaultValue": "value::all",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters - 1"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let StartTime = datetime(\"{TimeRange:startISO}\");\r\nlet EndTime = datetime(\"{TimeRange:endISO}\");\r\nlet TimeGrain = {TimeRange:grain};\r\nlet ZeroTimeSeries = repeat(0,array_length(range(StartTime,EndTime,TimeGrain)));\r\nlet GroupActivity = materialize ( \r\n    AuditLogs\r\n    | where Category == \"GroupManagement\"\r\n    {GroupName}\r\n    | where \"{SelectedGroup}\" == \"'*'\" or Group in ({SelectedGroup})\r\n    | where \"{SelectedActivity}\" == \"'*'\" or ActivityDisplayName in ({SelectedActivity})\r\n    | project TimeGenerated, ActivityDisplayName);\r\nGroupActivity\r\n| summarize Count = count() by ActivityDisplayName\r\n| join kind= inner ( \r\n    GroupActivity \r\n    | make-series TimeSeries = count() default = 0  on TimeGenerated in range(StartTime, EndTime, TimeGrain) by ActivityDisplayName\r\n    | project TimeSeries, ActivityDisplayName\r\n    )\r\n    on ActivityDisplayName\r\n| extend Count = iif(isempty(Count),0,Count)\r\n| extend TimeSeries = iif(isempty(TimeSeries),ZeroTimeSeries,TimeSeries)\r\n| project ActivityDisplayName, Count, TimeSeries\r\n| order by Count desc nulls last\r\n\r\n\r\n",
        "size": 1,
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "tiles",
        "tileSettings": {
          "titleContent": {
            "columnMatch": "ActivityDisplayName",
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "Count",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "style": "decimal",
                "maximumSignificantDigits": 3
              }
            }
          },
          "secondaryContent": {
            "columnMatch": "TimeSeries",
            "formatter": 10,
            "formatOptions": {
              "palette": "blue"
            }
          },
          "showBorder": false,
          "sortCriteriaField": "Ordered",
          "sortOrderField": 1
        }
      },
      "name": "query - Activities Tiles Overview"
    },
    {
      "type": 1,
      "content": {
        "json": "---"
      },
      "name": "text - 13"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "383b8bef-a9b8-4413-bb03-84e98ae5c15e",
            "cellValue": "ResultsBy",
            "linkTarget": "parameter",
            "linkLabel": "Overview",
            "subTarget": "Overview",
            "style": "link"
          },
          {
            "id": "2c6ddb86-ee8a-408d-80cf-30ff0361397f",
            "cellValue": "ResultsBy",
            "linkTarget": "parameter",
            "linkLabel": "All By Time Generated",
            "subTarget": "TimeGenerated",
            "style": "link"
          },
          {
            "id": "7fb53249-ec16-4267-8f08-e69f4b3e14bb",
            "cellValue": "ResultsBy",
            "linkTarget": "parameter",
            "linkLabel": "Membership",
            "subTarget": "Membership",
            "style": "link"
          },
          {
            "id": "0ee46529-3795-4db0-9cc6-5cfe521b4142",
            "cellValue": "ResultsBy",
            "linkTarget": "parameter",
            "linkLabel": "Group Creation / Deletion",
            "subTarget": "CreationDeletion",
            "style": "link"
          },
          {
            "id": "789e2f38-10f7-4ac8-a468-0fd5bf1288c6",
            "cellValue": "ResultsBy",
            "linkTarget": "parameter",
            "linkLabel": "Properties",
            "subTarget": "Properties",
            "style": "link"
          },
          {
            "id": "1efafc8c-2c7e-4ee7-8c7e-7007e87ad9e5",
            "cellValue": "ResultsBy",
            "linkTarget": "parameter",
            "linkLabel": "Licensing",
            "subTarget": "Licensing",
            "style": "link"
          },
          {
            "id": "6fec41db-de64-49c3-ba48-28d9595d0b28",
            "cellValue": "ResultsBy",
            "linkTarget": "parameter",
            "linkLabel": "App Role assignment",
            "subTarget": "AppRole",
            "style": "link"
          }
        ]
      },
      "name": "links - tabs"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "group - Overview",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Activities by Group\r\nThis rid view gives you an overview of the activites performed against each group based on your previous parameter selections, including a total count and Time Series chart representing the trend.\r\n\r\nSelect each indivdual activity to change the next graph. You must select each individual activity for each group you want to display.",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "Help",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "text - Help Activities Grid Overview"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "parameters": [
                {
                  "id": "846f2732-aa94-47e2-b19c-2a76401b29d6",
                  "version": "KqlParameterItem/1.0",
                  "name": "OverviewPage",
                  "label": "Page",
                  "type": 2,
                  "isRequired": true,
                  "query": "let pageSize = {LimitGridRowsTo};\r\nlet GroupManagementLogs = toscalar(AuditLogs\r\n| where Category == \"GroupManagement\"\r\n// extract the Group displayName first for filtering\r\n| where \"{SelectedAADTenantId}\" == \"'*'\" or AADTenantId in ({SelectedAADTenantId})\r\n{GroupName}\r\n| where \"{SelectedGroup}\" == \"'*'\" or Group in ({SelectedGroup})\r\n| where \"{SelectedActivity}\" == \"'*'\" or ActivityDisplayName in ({SelectedActivity})\r\n| summarize count() by Group, ActivityDisplayName\r\n| count);\r\nlet NumberofPages = (GroupManagementLogs / pageSize) + (iif( (GroupManagementLogs % pageSize) > 0, 1, 0));\r\nprint value = range(1,NumberofPages,1)\r\n| mv-expand value\r\n| extend value = iif(isnotempty(value),value,0)\r\n| extend label = value\r\n| serialize\r\n| extend selected = iif(row_number() in (0,1), true, false)",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 5"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let selectedPageNumber = {OverviewPage};\r\nlet pageSize = {LimitGridRowsTo};\r\nlet StartTime = datetime(\"{TimeRange:startISO}\");\r\nlet EndTime = datetime(\"{TimeRange:endISO}\");\r\nlet TimeGrain = {TimeRange:grain};\r\nlet GroupLogs = materialize (AuditLogs\r\n| where Category == \"GroupManagement\"\r\n// extract the Group displayName first for filtering\r\n| where \"{SelectedAADTenantId}\" == \"'*'\" or AADTenantId in ({SelectedAADTenantId})\r\n{GroupName}\r\n| where \"{SelectedGroup}\" == \"'*'\" or Group in ({SelectedGroup})\r\n| where \"{SelectedActivity}\" == \"'*'\" or ActivityDisplayName in ({SelectedActivity})\r\n    | extend AADTenandtIdGroupAndActivity = strcat(AADTenantId,\"_\",Group,\"_\",ActivityDisplayName)\r\n    | project TimeGenerated, Group, ActivityDisplayName, AADTenantId, AADTenandtIdGroupAndActivity, Result\r\n    );\r\nlet GroupLogsAggregation = GroupLogs\r\n    | make-series TimeSeries = count() default = 0 on TimeGenerated in range(StartTime, EndTime, TimeGrain) by AADTenandtIdGroupAndActivity\r\n    | project-away TimeGenerated\r\n    | extend Count = array_sum(TimeSeries);\r\nlet GroupLogsResults = GroupLogs\r\n    | evaluate pivot(Result, count(), AADTenandtIdGroupAndActivity)\r\n    | extend Success = column_ifexists(\"success\",0)\r\n    | extend Failure = column_ifexists(\"failure\",0)\r\n    | project AADTenandtIdGroupAndActivity, Success, Failure\r\n    ;\r\nlet GroupTotalCount = GroupLogsAggregation\r\n| summarize GroupCount = sum(Count) by AADTenandtIdGroupAndActivity;\r\nGroupTotalCount\r\n| join kind=innerunique (\r\n    GroupLogsAggregation\r\n    )\r\n    on AADTenandtIdGroupAndActivity\r\n| join kind = innerunique (\r\n    GroupLogsResults\r\n    )\r\n    on AADTenandtIdGroupAndActivity\r\n| join kind = innerunique (\r\n    GroupLogs\r\n    | summarize arg_max(TimeGenerated, *) by AADTenandtIdGroupAndActivity\r\n    ) \r\non AADTenandtIdGroupAndActivity\r\n| extend GroupAndActivity = strcat(Group, \"-\", ActivityDisplayName)\r\n| project\r\n    Group,\r\n    ActivityDisplayName,\r\n    AADTenantId,\r\n    Count,\r\n    Result =\"\",\r\n    Success,\r\n    Failure,\r\n    TimeSeries,\r\n    GroupAndActivity,\r\n    GroupCount\r\n| order by GroupCount desc, Count desc\r\n| project-away GroupCount\r\n| serialize \r\n| extend pageStart = pageSize * (selectedPageNumber - 1)\r\n| extend pageEnd = pageSize * (selectedPageNumber)\r\n| where row_number() > pageStart and row_number() <= pageEnd\r\n| project-away pageStart, pageEnd\r\n\r\n\r\n\r\n",
              "size": 0,
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "GroupAndActivity",
                  "parameterName": "selectedGroupAndActivity"
                }
              ],
              "showExportToExcel": true,
              "exportToExcelOptions": "all",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Add member to group",
                          "representation": "AddTeamMember",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Remove member from group",
                          "representation": "Delete",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Add group",
                          "representation": "Add",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Delete group",
                          "representation": "Subtract",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Start applying group based license to users",
                          "representation": "Start",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Finish applying group based license to users",
                          "representation": "Stop",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Set group license",
                          "representation": "Edit",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Update group",
                          "representation": "Properties",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Add app role assignment to group",
                          "representation": "AddTile",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Remove app role assignment from group",
                          "representation": "Canceled",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Add owner to group",
                          "representation": "Star",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Remove owner from group",
                          "representation": "Favorite",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Add a deletion-marked app role assignment grant to group as part of link removal",
                          "representation": "Link",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "PersonWithFriend",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Group",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "GroupUrl",
                      "linkTarget": "Url"
                    }
                  },
                  {
                    "columnMatch": "ActivityDisplayName",
                    "formatter": 5,
                    "formatOptions": {
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": [
                          {
                            "columnName": "ActivityDisplayName",
                            "color": "blue"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "Count",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "blue",
                      "aggregation": "Sum"
                    }
                  },
                  {
                    "columnMatch": "Result",
                    "formatter": 22,
                    "formatOptions": {
                      "aggregation": "Sum",
                      "compositeBarSettings": {
                        "labelText": "[\"Success\"] Success / [\"Failure\"] Failed",
                        "columnSettings": [
                          {
                            "columnName": "Success",
                            "color": "green"
                          },
                          {
                            "columnName": "Failure",
                            "color": "red"
                          }
                        ],
                        "noRowsScaling": true
                      }
                    }
                  },
                  {
                    "columnMatch": "Success",
                    "formatter": 5,
                    "formatOptions": {
                      "aggregation": "Sum",
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": [
                          {
                            "columnName": "Success",
                            "color": "green"
                          },
                          {
                            "columnName": "Failure",
                            "color": "red"
                          }
                        ],
                        "noRowsScaling": true
                      }
                    }
                  },
                  {
                    "columnMatch": "Failure",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "TimeSeries",
                    "formatter": 10,
                    "formatOptions": {
                      "palette": "blue",
                      "aggregation": "Sum"
                    }
                  },
                  {
                    "columnMatch": "GroupAndActivity",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "GroupId",
                    "formatter": 5
                  }
                ],
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "Group"
                  ],
                  "finalBy": "ActivityDisplayName"
                }
              }
            },
            "name": "query - Group Grid Overview"
          },
          {
            "type": 1,
            "content": {
              "json": "## Overview Time Series chart\r\n\r\nThis chart can change have its aggregation changed by selecting the parameter \"Chart Aggregation\" and changing it to **By Activity** or **By Group and Activity**\r\n\r\n**Time Brushing** is enabled on this chart and scoping the time will update the time range for the entire workbook\r\n",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "Help",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "text - 14"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "f600b79e-e4c4-45d6-83d6-76662da13f1e",
                  "version": "KqlParameterItem/1.0",
                  "name": "ChartAggregation",
                  "label": "Chart Aggregation",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n    {\"value\": \"ActivityDisplayName\", \"label\": \"By Activity\", \"selected\": true},\r\n    {\"value\": \"GroupAndActivity\", \"label\": \"By Group and Activity\", \"selected\": false}\r\n]",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - Overview Chart Aggregation"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let StartTime = datetime(\"{TimeRange:startISO}\");\r\nlet EndTime = datetime(\"{TimeRange:endISO}\");\r\nlet TimeGrain = {TimeRange:grain};\r\nlet GroupAndActivityList = todynamic('[{selectedGroupAndActivity}]');\r\nAuditLogs\r\n| where Category == \"GroupManagement\"\r\n| where \"{SelectedAADTenantId}\" == \"'*'\" or AADTenantId in ({SelectedAADTenantId})\r\n{GroupName}\r\n| extend GroupAndActivity = strcat(Group,\"-\",ActivityDisplayName)\r\n| where \"{SelectedGroup}\" == \"'*'\" or Group in ({SelectedGroup})\r\n| where \"{SelectedActivity}\" == \"'*'\" or ActivityDisplayName in ({SelectedActivity})\r\n| where array_length(GroupAndActivityList) == 0 or GroupAndActivity in (GroupAndActivityList)\r\n| make-series TimeSeries = count() default = 0  on TimeGenerated in range(StartTime, EndTime, TimeGrain) by {ChartAggregation}",
              "size": 0,
              "timeContext": {
                "durationMs": 2592000000
              },
              "timeContextFromParameter": "TimeRange",
              "timeBrushParameterName": "TimeRange",
              "timeBrushExportOnlyWhenBrushed": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "unstackedbar",
              "chartSettings": {
                "showLegend": true
              }
            },
            "name": "query - Overview Chart"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "ResultsBy",
        "comparison": "isEqualTo",
        "value": "Overview"
      },
      "name": "group - Overview"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Group - Results by Time Generated",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Results By Time Generated"
            },
            "name": "Text - Group By Chronology Title"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "parameters": [
                {
                  "id": "f2060db7-0136-4f54-9cf4-6c01efa9a0ac",
                  "version": "KqlParameterItem/1.0",
                  "name": "ByTimeGeneratedPage",
                  "label": "Page",
                  "type": 2,
                  "isRequired": true,
                  "query": "let pageSize = {LimitGridRowsTo};\r\nlet GroupManagementLogs = toscalar(AuditLogs\r\n| where Category == \"GroupManagement\"\r\n| where \"{SelectedAADTenantId}\" == \"'*'\" or AADTenantId in ({SelectedAADTenantId})\r\n| where \"{SelectedActivity}\" == \"'*'\" or ActivityDisplayName in ({SelectedActivity})\r\n// extract the GroupId displayName first for filtering\r\n{GroupName}\r\n| where \"{SelectedGroup}\" == \"'*'\" or Group in ({SelectedGroup})\r\n| count);\r\nlet NumberofPages = (GroupManagementLogs / pageSize) + (iif( (GroupManagementLogs % pageSize) > 0, 1, 0));\r\nprint value = range(1,NumberofPages,1)\r\n| mv-expand value\r\n| extend value = iif(isnotempty(value),value,0)\r\n| extend label = value\r\n| serialize\r\n| extend selected = iif(row_number() in (0,1), true, false)\r\n",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 2592000000
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - Results By Time Generated"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let selectedPageNumber = {ByTimeGeneratedPage};\r\nlet pageSize = {LimitGridRowsTo};\r\nAuditLogs\r\n| where Category == \"GroupManagement\"\r\n| where \"{SelectedAADTenantId}\" == \"'*'\" or AADTenantId in ({SelectedAADTenantId})\r\n| where \"{SelectedActivity}\" == \"'*'\" or ActivityDisplayName in ({SelectedActivity})\r\n// extract the GroupId displayName first for filtering\r\n{GroupName}\r\n| where \"{SelectedGroup}\" == \"'*'\" or Group in ({SelectedGroup})\r\n{GroupId}\r\n{InitiatedBy}\r\n| extend Info = \"More Info\"\r\n| extend GroupUrl = strcat(\"https://portal.azure.com/#blade/Microsoft_AAD_IAM/GroupDetailsMenuBlade/Overview/groupId/\", GroupId)\r\n| project\r\n    TimeGenerated,\r\n    TenantId,\r\n    Group,\r\n    GroupId,\r\n    GroupUrl,\r\n    ActivityDisplayName,\r\n    Result,\r\n    ResultType, \r\n    ResultDescription, \r\n    ResultReason,\r\n    Info,\r\n    InitiatedBy,\r\n    InitiatedByType,\r\n    InitiatedByName,\r\n    InitiatedById,\r\n    TargetResources,\r\n    CorrelationId,\r\n    AADTenantId,\r\n    Id\r\n| order by Group asc, TimeGenerated desc\r\n| serialize \r\n| extend pageStart = pageSize * (selectedPageNumber - 1)\r\n| extend pageEnd = pageSize * (selectedPageNumber)\r\n| where row_number() > pageStart and row_number() <= pageEnd\r\n| project-away pageStart, pageEnd\r\n\r\n\r\n",
              "size": 0,
              "showAnalytics": true,
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "exportToExcelOptions": "all",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 6,
                    "dateFormat": {
                      "showUtcTime": null,
                      "formatName": "shortDateTimePattern"
                    }
                  },
                  {
                    "columnMatch": "TenantId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Group",
                    "formatter": 18,
                    "formatOptions": {
                      "linkColumn": "GroupUrl",
                      "linkTarget": "Url",
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "PersonWithFriend",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "25.2857ch"
                    },
                    "tooltipFormat": {
                      "tooltip": "Selecting this link will open a new tab and take you to the AAD Group. If you are redirected to the home portal, you may lack the required permissions"
                    }
                  },
                  {
                    "columnMatch": "GroupId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "GroupUrl",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ActivityDisplayName",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Add member to group",
                          "representation": "AddTeamMember",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Remove member from group",
                          "representation": "Delete",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Add group",
                          "representation": "Add",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Delete group",
                          "representation": "Subtract",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Start applying group based license to users",
                          "representation": "Start",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Finish applying group based license to users",
                          "representation": "Stop",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Set group license",
                          "representation": "Edit",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Update group",
                          "representation": "Properties",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Add app role assignment to group",
                          "representation": "AddTile",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Remove app role assignment from group",
                          "representation": "Canceled",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Add owner to group",
                          "representation": "Star",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Remove owner from group",
                          "representation": "Favorite",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Add a deletion-marked app role assignment grant to group as part of link removal",
                          "representation": "Link",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "32.5ch"
                    }
                  },
                  {
                    "columnMatch": "Result",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "success",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "failure",
                          "representation": "failed",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "ResultType",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResultDescription",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResultReason",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Info",
                    "formatter": 18,
                    "formatOptions": {
                      "linkTarget": "GenericDetails",
                      "linkIsContextBlade": true,
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "1",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "InitiatedBy",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "InitiatedByName",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "InitiatedBy",
                      "linkTarget": "CellDetails",
                      "linkIsContextBlade": true
                    }
                  },
                  {
                    "columnMatch": "InitiatedById",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "TargetResources",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "CorrelationId",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "AADTenantId",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "Id",
                    "formatter": 5
                  }
                ],
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "ByTimeGeneratedPage",
              "comparison": "isNotEqualTo",
              "value": "0"
            },
            "name": "Query - Results By Time Generated Grid"
          },
          {
            "type": 1,
            "content": {
              "json": "## No Data found within the given selections. Update the parameter selections and try again",
              "style": "warning"
            },
            "conditionalVisibility": {
              "parameterName": "ByTimeGeneratedPage",
              "comparison": "isEqualTo",
              "value": "0"
            },
            "name": "text - 3"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "ResultsBy",
        "comparison": "isEqualTo",
        "value": "TimeGenerated"
      },
      "name": "Group - Results by Time Generated"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Group - Results by Membership ",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Results for Membership Changes"
            },
            "name": "Text - Group By Chronology Title"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "parameters": [
                {
                  "id": "cf0c4720-00af-45b7-9c93-00ccb098a01a",
                  "version": "KqlParameterItem/1.0",
                  "name": "MembershipActivitiesList",
                  "type": 2,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t\\\"Add member to group\\\", \\r\\n\\t\\\"Remove member from group\\\" \\r\\n]\",\"transformers\":null}",
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::all",
                  "queryType": 8
                },
                {
                  "id": "4131f1b1-d574-4f55-bfa8-d10cb2bbed70",
                  "version": "KqlParameterItem/1.0",
                  "name": "MembershipOverviewPageNumber",
                  "label": "Page",
                  "type": 2,
                  "isRequired": true,
                  "query": "let pageSize = {LimitGridRowsTo};\r\nlet GroupLogs = toscalar(AuditLogs\r\n    | where Category == \"GroupManagement\"\r\n    | where \"{SelectedAADTenantId}\" == \"'*'\" or AADTenantId in ({SelectedAADTenantId})\r\n    | where ActivityDisplayName in ({MembershipActivitiesList})\r\n    | where \"{SelectedActivity}\" == \"'*'\" or ActivityDisplayName in ({SelectedActivity})\r\n    {GroupName}\r\n    | where \"'*'\" == \"{SelectedGroup}\" or Group in ({SelectedGroup})\r\n    | count);\r\nlet NumberofPages = (GroupLogs / pageSize) + (iif( (GroupLogs % pageSize) > 0, 1, 0));\r\nprint value = range(1,NumberofPages,1)\r\n| mv-expand value\r\n| extend value = iif(isnotempty(value),value,0)\r\n| extend label = value\r\n| serialize\r\n| extend selected = iif(row_number() in (0,1), true, false)\r\n",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - Results for Membership Changes "
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let selectedPageNumber = {MembershipOverviewPageNumber};\r\nlet pageSize = {LimitGridRowsTo};\r\nAuditLogs\r\n    | where Category == \"GroupManagement\"\r\n    | where \"{SelectedAADTenantId}\" == \"'*'\" or AADTenantId in ({SelectedAADTenantId})\r\n    | project-away\r\n        ResourceId,\r\n        OperationVersion,\r\n        Category,\r\n        ResultSignature,\r\n        Resource,\r\n        ResourceGroup,\r\n        Level,\r\n        SourceSystem,\r\n        TenantId \r\n    | where ActivityDisplayName in ({MembershipActivitiesList})\r\n    | where \"{SelectedActivity}\" == \"'*'\" or ActivityDisplayName in ({SelectedActivity})\r\n    {GroupName}\r\n    | where \"'*'\" == \"{SelectedGroup}\" or Group in ({SelectedGroup})\r\n    {GroupId}\r\n    {UserDetails}\r\n    {InitiatedBy}\r\n    | extend Info = \"More Details\"\r\n    | extend GroupUrl = strcat(\"https://portal.azure.com/#blade/Microsoft_AAD_IAM/GroupDetailsMenuBlade/Overview/groupId/\", GroupId)   \r\n| project\r\n    TimeGenerated,\r\n    Group,\r\n    GroupId,\r\n    GroupUrl,\r\n    ActivityDisplayName,\r\n    Result,\r\n    ResultType, \r\n    ResultDescription, \r\n    ResultReason,\r\n    Info,\r\n    Object,\r\n    ObjectType,\r\n    ObjectId,\r\n    InitiatedBy,\r\n    InitiatedByType,\r\n    InitiatedByName,\r\n    InitiatedById,\r\n    TargetResources,\r\n    CorrelationId,\r\n    AADTenantId,\r\n    Id\r\n| order by  TimeGenerated desc\r\n| serialize \r\n| extend pageStart = pageSize * (selectedPageNumber - 1)\r\n| extend pageEnd = pageSize * (selectedPageNumber)\r\n| where row_number() > pageStart and row_number() <= pageEnd\r\n| project-away pageStart, pageEnd",
              "size": 2,
              "showAnalytics": true,
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "exportToExcelOptions": "all",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 6,
                    "dateFormat": {
                      "showUtcTime": null,
                      "formatName": "shortDateTimePattern"
                    }
                  },
                  {
                    "columnMatch": "Group",
                    "formatter": 18,
                    "formatOptions": {
                      "linkColumn": "GroupUrl",
                      "linkTarget": "Url",
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "PersonWithFriend",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "25.2857ch"
                    },
                    "tooltipFormat": {
                      "tooltip": "Selecting this link will open a new tab and take you to the AAD Group. If you are redirected to the home portal, you may lack the required permissions"
                    }
                  },
                  {
                    "columnMatch": "GroupId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "GroupUrl",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ActivityDisplayName",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Add member to group",
                          "representation": "AddTeamMember",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Remove member from group",
                          "representation": "Delete",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Add group",
                          "representation": "Add",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Delete group",
                          "representation": "Subtract",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Start applying group based license to users",
                          "representation": "Start",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Finish applying group based license to users",
                          "representation": "Stop",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Set group license",
                          "representation": "Edit",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Update group",
                          "representation": "Properties",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Add app role assignment to group",
                          "representation": "AddTile",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Remove app role assignment from group",
                          "representation": "Canceled",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Add owner to group",
                          "representation": "Star",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Remove owner from group",
                          "representation": "Favorite",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Add a deletion-marked app role assignment grant to group as part of link removal",
                          "representation": "Link",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "27ch"
                    }
                  },
                  {
                    "columnMatch": "Result",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "success",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "failure",
                          "representation": "failed",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Info",
                    "formatter": 18,
                    "formatOptions": {
                      "linkTarget": "GenericDetails",
                      "linkIsContextBlade": true,
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "1",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "ObjectId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "InitiatedBy",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "InitiatedByName",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "InitiatedBy",
                      "linkTarget": "CellDetails",
                      "linkIsContextBlade": true
                    }
                  },
                  {
                    "columnMatch": "InitiatedById",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "TargetResources",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "CorrelationId",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "AADTenantId",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "Id",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResultType",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResultDescription",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResultReason",
                    "formatter": 5
                  }
                ],
                "filter": true
              }
            },
            "name": "query - Results for Membership Changes Grid"
          },
          {
            "type": 1,
            "content": {
              "json": "## No Data found within the given selections. Update the parameter selections and try again",
              "style": "warning"
            },
            "conditionalVisibility": {
              "parameterName": "MembershipOverviewPageNumber",
              "comparison": "isEqualTo",
              "value": "0"
            },
            "name": "text - 3"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "ResultsBy",
        "comparison": "isEqualTo",
        "value": "Membership"
      },
      "name": "Group - Results by Membership "
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Group - Results by Group Creation/Deletion",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Results for Group Creation and Deletion"
            },
            "name": "Text - Group By Chronology Title"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "parameters": [
                {
                  "id": "cf0c4720-00af-45b7-9c93-00ccb098a01a",
                  "version": "KqlParameterItem/1.0",
                  "name": "CreationDeletionActivitiesList",
                  "type": 2,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t\\\"Add group\\\", \\r\\n\\t\\\"Remove group\\\" \\r\\n]\",\"transformers\":null}",
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::all",
                  "queryType": 8
                },
                {
                  "id": "4131f1b1-d574-4f55-bfa8-d10cb2bbed70",
                  "version": "KqlParameterItem/1.0",
                  "name": "CreationDeletionOverviewPageNumber",
                  "label": "Page",
                  "type": 2,
                  "isRequired": true,
                  "query": "let pageSize = {LimitGridRowsTo};\r\nlet GroupLogs = toscalar(AuditLogs\r\n    | where Category == \"GroupManagement\"\r\n    | where \"{SelectedAADTenantId}\" == \"'*'\" or AADTenantId in ({SelectedAADTenantId})\r\n    | where ActivityDisplayName in ({CreationDeletionActivitiesList})\r\n    | where \"{SelectedActivity}\" == \"'*'\" or ActivityDisplayName in ({SelectedActivity})\r\n    {GroupName}\r\n    | where \"'*'\" == \"{SelectedGroup}\" or Group in ({SelectedGroup})\r\n    | count);\r\nlet NumberofPages = (GroupLogs / pageSize) + (iif( (GroupLogs % pageSize) > 0, 1, 0));\r\nprint value = range(1,NumberofPages,1)\r\n| mv-expand value\r\n| extend value = iif(isnotempty(value),value,0)\r\n| extend label = value\r\n| serialize\r\n| extend selected = iif(row_number() in (0,1), true, false)\r\n",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 2592000000
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - Results for Membership Changes "
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let selectedPageNumber = {CreationDeletionOverviewPageNumber};\r\nlet pageSize = {LimitGridRowsTo};\r\nlet CreationDeletionLogs = AuditLogs\r\n    | where Category == \"GroupManagement\"\r\n    | where \"{SelectedAADTenantId}\" == \"'*'\" or AADTenantId in ({SelectedAADTenantId})\r\n    | project-away\r\n        ResourceId,\r\n        ResourceProvider,\r\n        Location,\r\n        OperationVersion,\r\n        Category,\r\n        ResultSignature,\r\n        Resource,\r\n        ResourceGroup,\r\n        Level,\r\n        SourceSystem,\r\n        TenantId,\r\n        AADOperationType,\r\n        OperationName,\r\n        DurationMs,\r\n        Type,\r\n        LoggedByService,\r\n        ActivityDateTime\r\n    | where ActivityDisplayName in ({CreationDeletionActivitiesList})\r\n    | where \"{SelectedActivity}\" == \"'*'\" or ActivityDisplayName in ({SelectedActivity})\r\n    {GroupName}\r\n    | where \"'*'\" == \"{SelectedGroup}\" or Group in ({SelectedGroup})\r\n    {GroupId}\r\n    {InitiatedBy};\r\nlet modifiedProperties = CreationDeletionLogs\r\n| project Id, TargetResources\r\n| mv-expand TargetResources = TargetResources[0].modifiedProperties\r\n| evaluate bag_unpack(TargetResources)\r\n| where displayName !in (\"Included Updated Properties\", \"DisplayName\")\r\n| mv-expand parse_json(newValue), parse_json(oldValue)\r\n| extend newValue = pack(\"newValue\", newValue)\r\n| extend oldValue = pack(\"oldValue\", oldValue)\r\n| extend packed = pack_array(newValue, oldValue)\r\n| evaluate pivot(displayName, any(packed), Id);\r\nCreationDeletionLogs\r\n| join kind=innerunique (\r\n    modifiedProperties\r\n    )\r\non Id\r\n| project-away Id1\r\n| extend Info = \"More Details\"\r\n| extend GroupUrl = strcat(\"https://portal.azure.com/#blade/Microsoft_AAD_IAM/GroupDetailsMenuBlade/Overview/groupId/\", GroupId) \r\n| project-reorder\r\n    TimeGenerated,\r\n    Group,\r\n    GroupId,\r\n    GroupUrl,\r\n    ActivityDisplayName,\r\n    Result,\r\n    ResultType, \r\n    ResultDescription, \r\n    ResultReason,\r\n    Info,\r\n    InitiatedBy,\r\n    InitiatedByType,\r\n    InitiatedByName,\r\n    InitiatedById,\r\n    TargetResources,\r\n    CorrelationId,\r\n    AADTenantId,\r\n    Id\r\n| order by TimeGenerated desc\r\n| serialize \r\n| extend pageStart = pageSize * (selectedPageNumber - 1)\r\n| extend pageEnd = pageSize * (selectedPageNumber)\r\n| where row_number() > pageStart and row_number() <= pageEnd\r\n| project-away pageStart, pageEnd",
              "size": 2,
              "showAnalytics": true,
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "exportToExcelOptions": "all",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 6,
                    "dateFormat": {
                      "showUtcTime": null,
                      "formatName": "shortDateTimePattern"
                    }
                  },
                  {
                    "columnMatch": "Group",
                    "formatter": 18,
                    "formatOptions": {
                      "linkColumn": "GroupUrl",
                      "linkTarget": "Url",
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "PersonWithFriend",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "25.2857ch"
                    },
                    "tooltipFormat": {
                      "tooltip": "Selecting this link will open a new tab and take you to the AAD Group. If you are redirected to the home portal, you may lack the required permissions"
                    }
                  },
                  {
                    "columnMatch": "GroupId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "GroupUrl",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ActivityDisplayName",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Add member to group",
                          "representation": "AddTeamMember",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Remove member from group",
                          "representation": "Delete",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Add group",
                          "representation": "Add",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Delete group",
                          "representation": "Subtract",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Start applying group based license to users",
                          "representation": "Start",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Finish applying group based license to users",
                          "representation": "Stop",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Set group license",
                          "representation": "Edit",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Update group",
                          "representation": "Properties",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Add app role assignment to group",
                          "representation": "AddTile",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Remove app role assignment from group",
                          "representation": "Canceled",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Add owner to group",
                          "representation": "Star",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Remove owner from group",
                          "representation": "Favorite",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Add a deletion-marked app role assignment grant to group as part of link removal",
                          "representation": "Link",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "27ch"
                    }
                  },
                  {
                    "columnMatch": "Result",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "success",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "failure",
                          "representation": "failed",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "ResultType",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResultDescription",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResultReason",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Info",
                    "formatter": 18,
                    "formatOptions": {
                      "linkTarget": "GenericDetails",
                      "linkIsContextBlade": true,
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "1",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "InitiatedBy",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "InitiatedByName",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "InitiatedBy",
                      "linkTarget": "CellDetails",
                      "linkIsContextBlade": true
                    }
                  },
                  {
                    "columnMatch": "InitiatedById",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "TargetResources",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "CorrelationId",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "AADTenantId",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "Id",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResultDetails",
                    "formatter": 5
                  }
                ],
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "CreationDeletionOverviewPageNumber",
              "comparison": "isNotEqualTo",
              "value": "0"
            },
            "name": "query - Results for Membership Changes Grid"
          },
          {
            "type": 1,
            "content": {
              "json": "## No Data found within the given selections. Update the parameter selections and try again",
              "style": "warning"
            },
            "conditionalVisibility": {
              "parameterName": "CreationDeletionOverviewPageNumber",
              "comparison": "isEqualTo",
              "value": "0"
            },
            "name": "text - 3"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "ResultsBy",
        "comparison": "isEqualTo",
        "value": "CreationDeletion"
      },
      "name": "Group - Results by Group Creation/Deletion"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Group - Results by Properties",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Results for Property Changes"
            },
            "name": "Text - Results for Property Changes"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "parameters": [
                {
                  "id": "cf0c4720-00af-45b7-9c93-00ccb098a01a",
                  "version": "KqlParameterItem/1.0",
                  "name": "PropertiesActivitiesList",
                  "type": 2,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t\\\"Update group\\\"\\r\\n]\",\"transformers\":null}",
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::all",
                  "queryType": 8
                },
                {
                  "id": "4131f1b1-d574-4f55-bfa8-d10cb2bbed70",
                  "version": "KqlParameterItem/1.0",
                  "name": "PropertiesOverviewPageNumber",
                  "label": "Page",
                  "type": 2,
                  "isRequired": true,
                  "query": "let pageSize = {LimitGridRowsTo};\r\nlet GroupLogs = toscalar(AuditLogs\r\n    | where Category == \"GroupManagement\"\r\n    | where \"{SelectedAADTenantId}\" == \"'*'\" or AADTenantId in ({SelectedAADTenantId})\r\n    | where ActivityDisplayName in ({PropertiesActivitiesList})\r\n    | where \"{SelectedActivity}\" == \"'*'\" or ActivityDisplayName in ({SelectedActivity})\r\n    {GroupName}\r\n    | where \"'*'\" == \"{SelectedGroup}\" or Group in ({SelectedGroup})\r\n    | count);\r\nlet NumberofPages = (GroupLogs / pageSize) + (iif( (GroupLogs % pageSize) > 0, 1, 0));\r\nprint value = range(1,NumberofPages,1)\r\n| mv-expand value\r\n| extend value = iif(isnotempty(value),value,0)\r\n| extend label = value\r\n| serialize\r\n| extend selected = iif(row_number() in (0,1), true, false)\r\n",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - Results for Property Changes"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let selectedPageNumber = {PropertiesOverviewPageNumber};\r\nlet pageSize = {LimitGridRowsTo};\r\nlet UpdatedGroupLogs = AuditLogs\r\n    | where Category == \"GroupManagement\"\r\n    | where \"{SelectedAADTenantId}\" == \"'*'\" or AADTenantId in ({SelectedAADTenantId})\r\n    | where ActivityDisplayName in ({PropertiesActivitiesList})\r\n    | where \"{SelectedActivity}\" == \"'*'\" or ActivityDisplayName in ({SelectedActivity})\r\n    {GroupName}\r\n    | where \"'*'\" == \"{SelectedGroup}\" or Group in ({SelectedGroup})\r\n    {GroupId}\r\n    {InitiatedBy}\r\n    | extend Info = \"More Details\"\r\n    | extend GroupUrl = strcat(\"https://portal.azure.com/#blade/Microsoft_AAD_IAM/GroupDetailsMenuBlade/Overview/groupId/\", GroupId);\r\nlet ModifiedPropertiesValues = UpdatedGroupLogs\r\n    | project Id, TargetResources\r\n    | mv-expand ModifiedProperties = TargetResources[0].modifiedProperties\r\n    | evaluate bag_unpack(ModifiedProperties)\r\n    | where displayName == \"Included Updated Properties\"\r\n    | extend ModifiedProperties = trim('\\\"',newValue)\r\n    | project Id, ModifiedProperties;\r\nUpdatedGroupLogs \r\n    | join kind = innerunique (ModifiedPropertiesValues)\r\non Id \r\n| project\r\n    TimeGenerated,\r\n    Group,\r\n    GroupId,\r\n    GroupUrl,\r\n    ActivityDisplayName,\r\n    Result,\r\n    ResultType, \r\n    ResultDescription, \r\n    ResultReason,\r\n    Info,\r\n    InitiatedBy,\r\n    InitiatedByType,\r\n    InitiatedByName,\r\n    InitiatedById,\r\n    ModifiedProperties,\r\n    TargetResources,\r\n    CorrelationId,\r\n    AADTenantId,\r\n    Id\r\n| order by  TimeGenerated desc\r\n| serialize \r\n| extend pageStart = pageSize * (selectedPageNumber - 1)\r\n| extend pageEnd = pageSize * (selectedPageNumber)\r\n| where row_number() > pageStart and row_number() <= pageEnd\r\n| project-away pageStart, pageEnd\r\n",
              "size": 2,
              "showAnalytics": true,
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "exportToExcelOptions": "all",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 6,
                    "dateFormat": {
                      "showUtcTime": null,
                      "formatName": "shortDateTimePattern"
                    }
                  },
                  {
                    "columnMatch": "Group",
                    "formatter": 18,
                    "formatOptions": {
                      "linkColumn": "GroupUrl",
                      "linkTarget": "Url",
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "PersonWithFriend",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "25.2857ch"
                    },
                    "tooltipFormat": {
                      "tooltip": "Selecting this link will open a new tab and take you to the AAD Group. If you are redirected to the home portal, you may lack the required permissions"
                    }
                  },
                  {
                    "columnMatch": "GroupId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "GroupUrl",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ActivityDisplayName",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Add member to group",
                          "representation": "AddTeamMember",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Remove member from group",
                          "representation": "Delete",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Add group",
                          "representation": "Add",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Delete group",
                          "representation": "Subtract",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Start applying group based license to users",
                          "representation": "Start",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Finish applying group based license to users",
                          "representation": "Stop",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Set group license",
                          "representation": "Edit",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Update group",
                          "representation": "Properties",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Add app role assignment to group",
                          "representation": "AddTile",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Remove app role assignment from group",
                          "representation": "Canceled",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Add owner to group",
                          "representation": "Star",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Remove owner from group",
                          "representation": "Favorite",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Add a deletion-marked app role assignment grant to group as part of link removal",
                          "representation": "Link",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "27ch"
                    }
                  },
                  {
                    "columnMatch": "Result",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "success",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "failure",
                          "representation": "failed",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Info",
                    "formatter": 18,
                    "formatOptions": {
                      "linkTarget": "GenericDetails",
                      "linkIsContextBlade": true,
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "1",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "InitiatedBy",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "InitiatedByName",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "InitiatedBy",
                      "linkTarget": "CellDetails",
                      "linkIsContextBlade": true
                    }
                  },
                  {
                    "columnMatch": "InitiatedById",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ModifiedProperties",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkIsContextBlade": false
                    }
                  },
                  {
                    "columnMatch": "TargetResources",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "CorrelationId",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "AADTenantId",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "Id",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResultType",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResultDescription",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResultReason",
                    "formatter": 5
                  }
                ],
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "PropertiesOverviewPageNumber",
              "comparison": "isNotEqualTo",
              "value": "0"
            },
            "name": "query - Results for Property Changes Overview"
          },
          {
            "type": 1,
            "content": {
              "json": "## No Data found within the given selections. Update the parameter selections and try again",
              "style": "warning"
            },
            "conditionalVisibility": {
              "parameterName": "PropertiesOverviewPageNumber",
              "comparison": "isEqualTo",
              "value": "0"
            },
            "name": "text - 3"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "ResultsBy",
        "comparison": "isEqualTo",
        "value": "Properties"
      },
      "name": "Group - Results for Property Changes"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Group - Results by Licensing",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Results for Licensing Changes"
            },
            "name": "Text - Results for Licensing"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "parameters": [
                {
                  "id": "cf0c4720-00af-45b7-9c93-00ccb098a01a",
                  "version": "KqlParameterItem/1.0",
                  "name": "LicensingActivitiesList",
                  "type": 2,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t\\\"Set group license\\\", \\r\\n\\t\\\"Start applying group based license to users\\\", \\r\\n\\t\\\"Finish applying group based license to users\\\"\\r\\n]\",\"transformers\":null}",
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::all",
                  "queryType": 8
                },
                {
                  "id": "4131f1b1-d574-4f55-bfa8-d10cb2bbed70",
                  "version": "KqlParameterItem/1.0",
                  "name": "LicensingOverviewPageNumber",
                  "label": "Page",
                  "type": 2,
                  "isRequired": true,
                  "query": "let pageSize = {LimitGridRowsTo};\r\nlet GroupLogs = toscalar(AuditLogs\r\n    | where Category == \"GroupManagement\"\r\n    | where \"{SelectedAADTenantId}\" == \"'*'\" or AADTenantId in ({SelectedAADTenantId})\r\n    | where ActivityDisplayName in ({LicensingActivitiesList})\r\n    | where \"{SelectedActivity}\" == \"'*'\" or ActivityDisplayName in ({SelectedActivity})\r\n    {GroupName}\r\n    | where \"'*'\" == \"{SelectedGroup}\" or Group in ({SelectedGroup})\r\n    | count);\r\nlet NumberofPages = (GroupLogs / pageSize) + (iif( (GroupLogs % pageSize) > 0, 1, 0));\r\nprint value = range(1,NumberofPages,1)\r\n| mv-expand value\r\n| extend value = iif(isnotempty(value),value,0)\r\n| extend label = value\r\n| serialize\r\n| extend selected = iif(row_number() in (0,1), true, false)\r\n",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 2592000000
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - Results for Licensing"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let selectedPageNumber = {LicensingOverviewPageNumber};\r\nlet pageSize = {LimitGridRowsTo};\r\nlet GroupLogs = AuditLogs\r\n    | where Category == \"GroupManagement\"\r\n    | where \"{SelectedAADTenantId}\" == \"'*'\" or AADTenantId in ({SelectedAADTenantId})\r\n    | project-away\r\n        ResourceId,\r\n        OperationVersion,\r\n        Category,\r\n        ResultSignature,\r\n        Resource,\r\n        ResourceGroup,\r\n        Level,\r\n        SourceSystem,\r\n        TenantId \r\n    | where ActivityDisplayName in ({LicensingActivitiesList})\r\n    | where \"{SelectedActivity}\" == \"'*'\" or ActivityDisplayName in ({SelectedActivity})\r\n    {GroupName}\r\n    | where \"'*'\" == \"{SelectedGroup}\" or Group in ({SelectedGroup});\r\nlet GroupDetails = \r\n    GroupLogs\r\n    | extend GroupId = tostring(TargetResources[0].id)\r\n    {InitiatedBy}\r\n    | extend Info = \"More Details\"\r\n    | extend GroupUrl = strcat(\"https://portal.azure.com/#blade/Microsoft_AAD_IAM/GroupDetailsMenuBlade/Overview/groupId/\", GroupId);   \r\n//Get Sku Lists \r\nlet AggregatedGroupDetails = \r\n    GroupLogs\r\n    | project ActivityDisplayName, CorrelationId, TargetResources, Id\r\n    | mv-expand ModifiedProperties = TargetResources[0].modifiedProperties[0]\r\n    | evaluate bag_unpack(ModifiedProperties)\r\n    //| where isempty(displayName)\r\n    | extend oldValue = column_ifexists(\"oldValue\", \"\")\r\n    | extend newValue = column_ifexists(\"newValue\", \"\")\r\n    | mv-expand parse_json(newValue), parse_json(oldValue)\r\n    | parse oldValue with * \"SkuName=\" OldSkuValue \", AccountId=\" Drop \r\n    | parse newValue with * \"SkuName=\" NewSkuValue \", AccountId=\" Drop \r\n    | project-away Drop, oldValue, newValue\r\n    //\r\n    | extend Message = iif(ActivityDisplayName == \"Finish applying group based license to users\", \r\n        tostring(parse_json(tostring(parse_json(tostring(TargetResources[0].modifiedProperties))[1].newValue))),\r\n        \"\")\r\n   \r\n    | parse Message with * \"licenses: \" Success: int * \"failed: \" Failed: int *\r\n    | extend Success = iif(isempty(Success),0,Success)\r\n    | extend Failed = iif(isempty(Failed),0,Failed)\r\n    | summarize\r\n        OldSkuValue = make_list_if(OldSkuValue, isnotempty(OldSkuValue)),\r\n        NewSkuValue = make_list_if(NewSkuValue, isnotempty(NewSkuValue))\r\n        by Id, Success, Failed;\r\nAggregatedGroupDetails\r\n| join kind=inner (GroupDetails) on Id\r\n| project\r\n    TimeGenerated,\r\n    Group,\r\n    GroupId,\r\n    GroupUrl,\r\n    ActivityDisplayName,\r\n    Result,\r\n    ResultType, \r\n    ResultDescription, \r\n    ResultReason,\r\n    Info,\r\n    ['Success/Failed'] = \"\",\r\n    Success, \r\n    Failed,\r\n    InitiatedBy,\r\n    InitiatedByType,\r\n    InitiatedByName,\r\n    InitiatedById,\r\n    TargetResources,\r\n    OldSkuValue,\r\n    NewSkuValue,\r\n    CorrelationId,\r\n    AADTenantId,\r\n    Id\r\n| order by  TimeGenerated desc\r\n| serialize \r\n| extend pageStart = pageSize * (selectedPageNumber - 1)\r\n| extend pageEnd = pageSize * (selectedPageNumber)\r\n| where row_number() > pageStart and row_number() <= pageEnd\r\n| project-away pageStart, pageEnd",
              "size": 1,
              "showAnalytics": true,
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "CorrelationId",
              "exportParameterName": "selectedCorrelationId",
              "showExportToExcel": true,
              "exportToExcelOptions": "all",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 6,
                    "dateFormat": {
                      "showUtcTime": null,
                      "formatName": "shortDateTimePattern"
                    }
                  },
                  {
                    "columnMatch": "Group",
                    "formatter": 18,
                    "formatOptions": {
                      "linkColumn": "GroupUrl",
                      "linkTarget": "Url",
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "PersonWithFriend",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "25.2857ch"
                    },
                    "tooltipFormat": {
                      "tooltip": "Selecting this link will open a new tab and take you to the AAD Group. If you are redirected to the home portal, you may lack the required permissions"
                    }
                  },
                  {
                    "columnMatch": "GroupId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "GroupUrl",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ActivityDisplayName",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Add member to group",
                          "representation": "AddTeamMember",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Remove member from group",
                          "representation": "Delete",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Add group",
                          "representation": "Add",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Delete group",
                          "representation": "Subtract",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Start applying group based license to users",
                          "representation": "Start",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Finish applying group based license to users",
                          "representation": "Stop",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Set group license",
                          "representation": "Edit",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Update group",
                          "representation": "Properties",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Add app role assignment to group",
                          "representation": "AddTile",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Remove app role assignment from group",
                          "representation": "Canceled",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Add owner to group",
                          "representation": "Star",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Remove owner from group",
                          "representation": "Favorite",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Add a deletion-marked app role assignment grant to group as part of link removal",
                          "representation": "Link",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "42ch"
                    }
                  },
                  {
                    "columnMatch": "Result",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "success",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "failure",
                          "representation": "failed",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Info",
                    "formatter": 18,
                    "formatOptions": {
                      "linkTarget": "GenericDetails",
                      "linkIsContextBlade": true,
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "1",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Success/Failed",
                    "formatter": 22,
                    "formatOptions": {
                      "compositeBarSettings": {
                        "labelText": "[\"Success\"] Success / [\"Failed\"] Failed",
                        "columnSettings": [
                          {
                            "columnName": "Success",
                            "color": "green"
                          },
                          {
                            "columnName": "Failed",
                            "color": "redBright"
                          }
                        ],
                        "noRowsScaling": true
                      }
                    }
                  },
                  {
                    "columnMatch": "Success",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Failed",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "InitiatedBy",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "InitiatedByName",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "InitiatedBy",
                      "linkTarget": "CellDetails",
                      "linkIsContextBlade": true
                    }
                  },
                  {
                    "columnMatch": "InitiatedById",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "TargetResources",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "CorrelationId",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "AADTenantId",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "Id",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResultType",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResultDescription",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResultReason",
                    "formatter": 5
                  }
                ],
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "LicensingOverviewPageNumber",
              "comparison": "isNotEqualTo",
              "value": "0"
            },
            "name": "query - Results for Licensing Overview"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let filteredLogs = AuditLogs\r\n    | where CorrelationId == \"{selectedCorrelationId}\";\r\nlet firstLog = toscalar(filteredLogs\r\n    | summarize min(TimeGenerated));\r\nlet lastLog = toscalar(filteredLogs\r\n    | summarize max(TimeGenerated));\r\nlet CompletedTime = toscalar(filteredLogs\r\n    | where OperationName == \"Finish applying group based license to users\"\r\n    | project TimeGenerated);\r\nfilteredLogs\r\n    | extend userPrincipalName = tostring(TargetResources[0].userPrincipalName)\r\n    | summarize TimeGenerated = max(TimeGenerated) by userPrincipalName\r\n    | make-series Count = count() default = 0 on TimeGenerated in range (firstLog, lastLog, 1m)\r\n    | extend Stats = series_stats_dynamic(Count)\r\n    | project  \r\n        TimeStarted = firstLog,\r\n        CompletedTime = CompletedTime ,\r\n        TimeTaken = case(isnotempty(CompletedTime),\r\n            datetime_diff(\"Second\", CompletedTime, firstLog),\r\n            datetime_diff(\"Second\", now(), firstLog)\r\n        ),\r\n        TotalCompleted = Stats.sum, \r\n        AverageEventPerMinute = round(toint(Stats.avg))\r\n\r\n\r\n\r\n\r\n",
                    "size": 4,
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeStarted",
                          "formatter": 6
                        },
                        {
                          "columnMatch": "CompletedTime",
                          "formatter": 6
                        },
                        {
                          "columnMatch": "TimeTaken",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "TotalCompleted",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 17,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "AverageEventPerMinute",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 17,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        }
                      ]
                    },
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "title",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "left",
                        "formatter": 6,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        },
                        "dateFormat": {
                          "formatName": "shortDateTimePattern"
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "right",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "name": "query - 8"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let filteredLogs = AuditLogs\r\n    | where CorrelationId == \"{selectedCorrelationId}\"; \r\nlet startTime = toscalar(filteredLogs\r\n    | summarize min(TimeGenerated));\r\nlet endTime = toscalar(filteredLogs\r\n    | summarize max(TimeGenerated));\r\nfilteredLogs\r\n| extend userPrincipalName = tostring(TargetResources[0].userPrincipalName)\r\n| summarize arg_max(TimeGenerated, Result) by userPrincipalName\r\n| make-series Count = count() default = 0 on TimeGenerated in range (startTime, endTime, 1m) by Result\r\n\r\n",
                    "size": 0,
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "barchart"
                  },
                  "name": "query - 7"
                }
              ]
            },
            "name": "group - 10",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 1,
            "content": {
              "json": "## No Data found within the given selections. Update the parameter selections and try again",
              "style": "warning"
            },
            "conditionalVisibility": {
              "parameterName": "LicensingOverviewPageNumber",
              "comparison": "isEqualTo",
              "value": "0"
            },
            "name": "text - 3"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "parameters": [
                {
                  "id": "d013802a-618e-42f9-bea8-eebc294a8476",
                  "version": "KqlParameterItem/1.0",
                  "name": "LicensingDrillDownPage",
                  "label": "Page",
                  "type": 2,
                  "isRequired": true,
                  "query": "let pageSize = {LimitGridRowsTo};\r\nlet changeUserLicenseCount = toscalar(AuditLogs\r\n    | where \"{SelectedAADTenantId}\" == \"'*'\" or AADTenantId in ({SelectedAADTenantId})\r\n    | where CorrelationId == \"{selectedCorrelationId}\"\r\n    | where ActivityDisplayName == \"Change user license\"\r\n    {UserDetails}\r\n    | extend AdditionalDetails = tostring(AdditionalDetails[2].value)\r\n| summarize max(TimeGenerated) by Object\r\n| count);\r\nlet NumberofPages = (changeUserLicenseCount / pageSize) + (iif( (changeUserLicenseCount % pageSize) > 0, 1, 0));\r\nprint value = range(1,NumberofPages,1)\r\n| mv-expand value\r\n| extend value = iif(isnotempty(value),value,0)\r\n| extend label = value\r\n| serialize\r\n| extend selected = iif(row_number() in (0,1), true, false)\r\n",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 2592000000
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "conditionalVisibility": {
              "parameterName": "selectedCorrelationId",
              "comparison": "isNotEqualTo"
            },
            "name": "parameters - Results for Licensing"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let selectedPageNumber = {LicensingDrillDownPage};\r\nlet pageSize = {LimitGridRowsTo};\r\nlet changeUserLicenseDetails = AuditLogs\r\n    | where \"{SelectedAADTenantId}\" == \"'*'\" or AADTenantId in ({SelectedAADTenantId})\r\n    | where CorrelationId == \"{selectedCorrelationId}\"\r\n    | where ActivityDisplayName == \"Change user license\"\r\n    | project TimeGenerated, \r\n        InitiatedBy,\r\n        TargetResources,\r\n        AdditionalDetails,\r\n        Result,\r\n        ResultType, \r\n        ResultDescription, \r\n        ResultReason,\r\n        CorrelationId,\r\n        AADTenantId,\r\n        Id\r\n    | extend Object = tostring(TargetResources[0].userPrincipalName)\r\n    | extend ObjectId = tostring(TargetResources[0].id);\r\nlet changeUserLicenseAdditionalDetails = \r\n    changeUserLicenseDetails\r\n    | project ObjectId, AdditionalDetails, Id\r\n    | extend Sequence = toint(AdditionalDetails[1].value)\r\n    | extend AdditionalDetails = tostring(AdditionalDetails[2].value)\r\n    | order by ObjectId asc, Sequence asc\r\n    | summarize AdditionalDetails = make_list(AdditionalDetails), ids = make_list(Id) by ObjectId\r\n    | extend AdditionalDetails = parse_json(array_strcat(AdditionalDetails, ''));\r\nchangeUserLicenseAdditionalDetails\r\n| join kind=rightouter  (\r\n    changeUserLicenseDetails\r\n    | summarize arg_max(TimeGenerated, *) by ObjectId\r\n    )\r\n    on ObjectId\r\n| extend ModifiedProperties = tostring(parse_json(tostring(TargetResources[0].modifiedProperties)))\r\n| extend ModifiedProperties = pack(\"ModifiedProperties\", ModifiedProperties, \"AdditionalDetails\", AdditionalDetails)\r\n| project  \r\n    TimeGenerated, \r\n    Object, \r\n    ObjectId,\r\n    Result,\r\n    ResultType, \r\n    ResultDescription, \r\n    ResultReason,\r\n    Info  = \"More Details\",\r\n    InitiatedBy,\r\n    TargetResources,\r\n    ModifiedProperties,\r\n    CorrelationId,\r\n    AADTenantId,\r\n    ids\r\n| order by TimeGenerated desc\r\n| serialize \r\n| extend pageStart = pageSize * (selectedPageNumber - 1)\r\n| extend pageEnd = pageSize * (selectedPageNumber)\r\n| where row_number() > pageStart and row_number() <= pageEnd\r\n| project-away pageStart, pageEnd\r\n\r\n\r\n",
              "size": 0,
              "showAnalytics": true,
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "exportedParameters": [
                {
                  "fieldName": "ObjectId",
                  "parameterName": "selectedObjectId"
                },
                {
                  "fieldName": "AdditionalDetails",
                  "parameterName": "selectedAdditionalDetails",
                  "parameterType": 1
                }
              ],
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "ObjectId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Result",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "success",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "failure",
                          "representation": "failed",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Info",
                    "formatter": 18,
                    "formatOptions": {
                      "linkTarget": "GenericDetails",
                      "linkIsContextBlade": true,
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "1",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "InitiatedBy",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "TargetResources",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ModifiedProperties",
                    "formatter": 18,
                    "formatOptions": {
                      "linkColumn": "ModifiedProperties",
                      "linkTarget": "CellDetails",
                      "linkIsContextBlade": true,
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Properties",
                          "text": "Modified Properties"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "CorrelationId",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "AADTenantId",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "ids",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResultType",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResultDescription",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResultReason",
                    "formatter": 5
                  }
                ],
                "filter": true
              }
            },
            "conditionalVisibilities": [
              {
                "parameterName": "selectedCorrelationId",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "LicensingDrillDownPage",
                "comparison": "isNotEqualTo",
                "value": "0"
              }
            ],
            "name": "query - Results for Licensing per User"
          },
          {
            "type": 1,
            "content": {
              "json": "## No Data found within the given selections. Update the parameter selections and try again",
              "style": "warning"
            },
            "conditionalVisibility": {
              "parameterName": "LicensingDrillDownPage",
              "comparison": "isEqualTo",
              "value": "0"
            },
            "name": "text - 3"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "ResultsBy",
        "comparison": "isEqualTo",
        "value": "Licensing"
      },
      "name": "Group - Results for Licensing"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Group - Results for App Role Assignment",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Results by App Role Assignment"
            },
            "name": "text - Results for App Role Assignment"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "parameters": [
                {
                  "id": "7def500c-b29a-48e7-a4fa-9ef6458fe366",
                  "version": "KqlParameterItem/1.0",
                  "name": "AppRoleActivitiesList",
                  "type": 2,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t\\\"Add app role assignment to group\\\", \\r\\n\\t\\\"Remove app role assignment from group\\\",\\r\\n\\t\\\"Add a deletion-marked app role assignment grant to group as part of link removal\\\"\\r\\n]\",\"transformers\":null}",
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 2592000000
                  },
                  "timeContextFromParameter": "TimeRange",
                  "defaultValue": "value::all",
                  "queryType": 8
                },
                {
                  "id": "1e29696c-2071-42b7-baa7-63cb3a0b3702",
                  "version": "KqlParameterItem/1.0",
                  "name": "AppRoleOverviewPageNumber",
                  "label": "Page",
                  "type": 2,
                  "isRequired": true,
                  "query": "let pageSize = {LimitGridRowsTo};\r\nlet GroupLogs = toscalar(AuditLogs\r\n    | where Category == \"GroupManagement\"\r\n    | where \"{SelectedAADTenantId}\" == \"'*'\" or AADTenantId in ({SelectedAADTenantId})\r\n    | where ActivityDisplayName in ({AppRoleActivitiesList})\r\n    | where \"{SelectedActivity}\" == \"'*'\" or ActivityDisplayName in ({SelectedActivity})\r\n    {GroupName}\r\n    | where \"'*'\" == \"{SelectedGroup}\" or Group in ({SelectedGroup})\r\n    | count);\r\nlet NumberofPages = (GroupLogs / pageSize) + (iif( (GroupLogs % pageSize) > 0, 1, 0));\r\nprint value = range(1,NumberofPages,1)\r\n| mv-expand value\r\n| extend value = iif(isnotempty(value),value,0)\r\n| extend label = value\r\n| serialize\r\n| extend selected = iif(row_number() in (0,1), true, false)\r\n",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 2592000000
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - Results for App Role Assignment"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let selectedPageNumber = {AppRoleOverviewPageNumber};\r\nlet pageSize = {LimitGridRowsTo};\r\nAuditLogs\r\n| where Category == \"GroupManagement\"\r\n| where \"{SelectedAADTenantId}\" == \"'*'\" or AADTenantId in ({SelectedAADTenantId})\r\n{GroupName}\r\n| where \"{SelectedGroup}\" == \"'*'\" or Group in ({SelectedGroup})\r\n{GroupId}\r\n| where ActivityDisplayName in ({AppRoleActivitiesList})\r\n| where \"{SelectedActivity}\" == \"'*'\" or ActivityDisplayName in ({SelectedActivity})\r\n| extend ApplicationId = tostring(AdditionalDetails[1].value)\r\n| extend Application = tostring(TargetResources[0].displayName)\r\n| extend ObjectId = tostring(TargetResources[0].id)\r\n| extend ObjectType = tostring(TargetResources[0].type)\r\n| extend InitiatedByType = case(isnotempty(InitiatedBy.app), \"app\", \"user\")\r\n| extend InitiatedByName = case(InitiatedByType == \"app\", InitiatedBy.app.displayName, InitiatedByType == \"user\", InitiatedBy.user.userPrincipalName, \"Error - Unknown\")\r\n| extend InitiatedById = case(InitiatedByType == \"app\", InitiatedBy.app.servicePrincipalId, InitiatedByType == \"user\", InitiatedBy.user.id, \"Error - Unknown\")\r\n| extend AppRoleDisplayName = tostring(parse_json(tostring(parse_json(tostring(TargetResources[0].modifiedProperties))[2].newValue)))\r\n| extend AppRoleId = tostring(parse_json(tostring(parse_json(tostring(TargetResources[0].modifiedProperties))[0].newValue)))\r\n| extend AppRoleValue = tostring(parse_json(tostring(TargetResources[0].modifiedProperties))[1].newValue)\r\n| extend GroupWellKnownObjectName = tostring(parse_json(tostring(TargetResources[0].modifiedProperties))[5].newValue)\r\n| extend TargetIdServicePrincipalNames = tostring(parse_json(tostring(parse_json(tostring(TargetResources[0].modifiedProperties))[6].newValue)))\r\n| extend Info = \"More Details\"\r\n| extend GroupUrl = strcat(\"https://portal.azure.com/#blade/Microsoft_AAD_IAM/GroupDetailsMenuBlade/Overview/groupId/\", GroupId)\r\n| project \r\n    TimeGenerated, \r\n    Group, \r\n    GroupId, \r\n    GroupUrl, \r\n    ActivityDisplayName, \r\n    Result,\r\n    ResultType, \r\n    ResultDescription, \r\n    ResultReason,\r\n    Info,\r\n    ApplicationId,\r\n    Application, \r\n    ObjectId, \r\n    ObjectType, \r\n    InitiatedByName, \r\n    InitiatedById, \r\n    InitiatedByType, \r\n    InitiatedBy, \r\n    AppRoleDisplayName, \r\n    GroupWellKnownObjectName,\r\n    AppRoleId, \r\n    TargetIdServicePrincipalNames, \r\n    TargetResources, \r\n    CorrelationId,\r\n    Id,\r\n    AADTenantId\r\n| order by TimeGenerated desc\r\n| serialize \r\n| extend pageStart = pageSize * (selectedPageNumber - 1)\r\n| extend pageEnd = pageSize * (selectedPageNumber)\r\n| where row_number() > pageStart and row_number() <= pageEnd\r\n| project-away pageStart, pageEnd",
              "size": 1,
              "showAnalytics": true,
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "exportToExcelOptions": "all",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 6,
                    "dateFormat": {
                      "showUtcTime": null,
                      "formatName": "shortDateTimePattern"
                    }
                  },
                  {
                    "columnMatch": "Group",
                    "formatter": 18,
                    "formatOptions": {
                      "linkColumn": "GroupUrl",
                      "linkTarget": "Url",
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "PersonWithFriend",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "25.2857ch"
                    },
                    "tooltipFormat": {
                      "tooltip": "Selecting this link will open a new tab and take you to the AAD Group. If you are redirected to the home portal, you may lack the required permissions"
                    }
                  },
                  {
                    "columnMatch": "GroupId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "GroupUrl",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ActivityDisplayName",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "27ch"
                    }
                  },
                  {
                    "columnMatch": "Result",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "success",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "failure",
                          "representation": "failed",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Info",
                    "formatter": 18,
                    "formatOptions": {
                      "linkTarget": "GenericDetails",
                      "linkIsContextBlade": true,
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "1",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "ApplicationId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Id",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "InitiatedByName",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "InitiatedBy",
                      "linkTarget": "CellDetails",
                      "linkIsContextBlade": true
                    }
                  },
                  {
                    "columnMatch": "InitiatedById",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "InitiatedBy",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "AppRoleDisplayName",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "GroupWellKnownObjectName",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "AppRoleId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "TargetIdServicePrincipalNames",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "TargetResources",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "CorrelationId",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "AADTenantId",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "AppRoleValue",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResultType",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResultDescription",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResultReason",
                    "formatter": 5
                  }
                ],
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "AppRoleOverviewPageNumber",
              "comparison": "isNotEqualTo",
              "value": "0"
            },
            "name": "query - Results for App Role Assignment Overview"
          },
          {
            "type": 1,
            "content": {
              "json": "## No Data found within the given selections. Update the parameter selections and try again",
              "style": "warning"
            },
            "conditionalVisibility": {
              "parameterName": "AppRoleOverviewPageNumber",
              "comparison": "isEqualTo",
              "value": "0"
            },
            "name": "text - 3"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "ResultsBy",
        "comparison": "isEqualTo",
        "value": "AppRole"
      },
      "name": "Group - Results for App Role Assignment"
    }
  ],
  "fallbackResourceIds": [
    "Azure Monitor"
  ],
  "fromTemplateId": "sentinel-UserWorkbook",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
